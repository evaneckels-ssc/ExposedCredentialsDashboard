<!DOCTYPE html>
<!--
    SecurityScorecard Exposed Credentials Dashboard
    
    Built by: Evan Eckels - SecurityScorecard
    
    A comprehensive web application for analyzing exposed credentials data using the SecurityScorecard API.
    Features two analysis modes: Global Discovery (3-panel flow) and Targeted Search (2-panel flow).
    
    For questions, issues, or feature requests, contact: evan.eckels@securityscorecard.io
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exposed Credentials Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        /* Reset and General Styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #231f20;
            height: 100vh;
            overflow: hidden;
        }

        /* Header Styling */
        .header {
            background-color: #ffffff;
            border-bottom: 1px solid #e3e3e3;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
        }

        .header-row.filter-bar {
            background-color: #f8f9fa;
            border-top: 1px solid #e3e3e3;
            padding: 10px 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 120px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo svg {
            width: 120px;
            height: 32px;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #231f20;
            margin: 0;
        }

        .mode-toggle {
            display: flex;
            background-color: #e3e3e3;
            border-radius: 4px;
            overflow: hidden;
        }

        .mode-toggle button {
            padding: 8px 16px;
            border: none;
            background-color: transparent;
            color: #8d9a9e;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .mode-toggle button.active {
            background-color: #594ef3;
            color: white;
        }

        .header-button {
            padding: 8px 16px;
            border: 1px solid #bccbcb;
            border-radius: 4px;
            background-color: white;
            color: #231f20;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .header-button:hover {
            background-color: #f5f5f5;
            border-color: #594ef3;
        }

        .header-button .material-symbols-outlined {
            font-size: 18px;
        }

        .help-button {
            padding: 8px 10px;
            min-width: auto;
        }

        .help-button svg {
            width: 20px;
            height: 20px;
        }

        /* Help Modal Specific Styles */
        .help-modal-content {
            width: 750px;
            max-width: 90vw;
            max-height: 85vh;
            overflow-y: auto;
        }

        .help-modal-body {
            max-height: calc(85vh - 140px);
            overflow-y: auto;
            padding: 24px;
        }

        .help-section {
            margin-bottom: 32px;
        }

        .help-section:last-child {
            margin-bottom: 0;
        }

        .help-section h3 {
            font-size: 18px;
            font-weight: 600;
            color: #231f20;
            margin: 0 0 14px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-section p {
            margin: 0 0 14px 0;
            line-height: 1.7;
            color: #636466;
            font-size: 14px;
        }

        .help-section ul {
            margin: 0 0 14px 0;
            padding-left: 24px;
            list-style-type: disc;
        }

        .help-section li {
            margin-bottom: 10px;
            line-height: 1.7;
            color: #636466;
            font-size: 14px;
        }

        .help-section code {
            background-color: #f8f9fa;
            padding: 3px 7px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #594ef3;
            font-weight: 500;
        }

        .workflow-steps {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .workflow-step {
            display: flex;
            gap: 18px;
            align-items: flex-start;
        }

        .step-number {
            flex-shrink: 0;
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #594ef3 0%, #512b70 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 17px;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            font-size: 16px;
            font-weight: 600;
            color: #231f20;
            margin: 0 0 8px 0;
        }

        .step-content p {
            margin: 0 0 10px 0;
            line-height: 1.7;
            color: #636466;
        }

        .step-content p:last-child {
            margin-bottom: 0;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
            margin-top: 16px;
        }

        .feature-item {
            padding: 18px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e3e3e3;
        }

        .feature-item strong {
            display: block;
            margin-bottom: 8px;
            color: #231f20;
            font-size: 15px;
        }

        .feature-item p {
            margin: 0;
            font-size: 13px;
            color: #636466;
            line-height: 1.6;
        }

        .example-box {
            background-color: #f8f9fa;
            border-left: 4px solid #594ef3;
            padding: 22px;
            border-radius: 6px;
            margin-top: 16px;
        }

        .example-box p {
            margin: 0 0 14px 0;
            font-weight: 600;
            color: #231f20;
            font-size: 15px;
        }

        .example-box ol {
            margin: 0;
            padding-left: 24px;
        }

        .example-box li {
            margin-bottom: 10px;
            line-height: 1.7;
            color: #636466;
        }

        .example-box li:last-child {
            margin-bottom: 0;
        }

        /* Filter Bar */
        .filter-controls {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .filter-input-wrapper svg {
            position: absolute;
            left: 10px;
            width: 18px;
            height: 18px;
            fill: #8d9a9e;
            pointer-events: none;
        }

        .filter-input-wrapper input {
            padding-left: 36px !important;
        }

        .filter-label {
            font-size: 11px;
            font-weight: 500;
            color: #8d9a9e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-group input, .filter-group select {
            padding: 6px 10px;
            border: 1px solid #bccbcb;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
            min-width: 150px;
            height: 34px;
            box-sizing: border-box;
        }

        .filter-group input:focus, .filter-group select:focus {
            outline: none;
            border-color: #594ef3;
            box-shadow: 0 0 0 2px rgba(89, 78, 243, 0.1);
        }

        /* Style calendar icon for date inputs */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(54%) sepia(8%) saturate(413%) hue-rotate(155deg) brightness(93%) contrast(88%);
            cursor: pointer;
        }

        .action-button {
            padding: 7px 16px;
            background: linear-gradient(135deg, #594ef3 0%, #512b70 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            height: 34px;
            box-sizing: border-box;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(89, 78, 243, 0.3);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .action-button .material-symbols-outlined {
            font-size: 18px;
        }

        .action-button:disabled {
            background: #e3e3e3;
            color: #8d9a9e;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .action-button.secondary {
            background: white;
            color: #636466;
            border: 1px solid #bccbcb;
        }

        .action-button.secondary:hover {
            background-color: #f8f9fa;
            border-color: #594ef3;
            color: #594ef3;
            box-shadow: none;
        }

        .action-button.secondary:active {
            transform: translateY(0);
            background-color: #f0f0f0;
        }

        .action-button.secondary .material-symbols-outlined {
            color: inherit;
        }

        /* Main Container */
        .main-container {
            display: flex;
            height: calc(100vh - 140px);
            overflow: hidden;
        }

        /* Global Mode: 3 columns */
        body.global-mode .main-container {
            display: grid;
            grid-template-columns: 280px 280px 1fr;
        }

        /* Search Mode: 2 columns */
        body.search-mode .main-container {
            display: grid;
            grid-template-columns: 320px 1fr;
        }

        body.search-mode .sidebar-left {
            display: none;
        }

        body.search-mode .sidebar-center {
            width: 320px;
        }

        /* Sidebar Styles */
        .sidebar-left, .sidebar-center {
            background-color: #ffffff;
            border-right: 1px solid #e3e3e3;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 8px 10px;
            border-bottom: 1px solid #e3e3e3;
            background-color: #f8f9fa;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: #231f20;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-title svg {
            width: 18px;
            height: 18px;
            fill: #594ef3;
        }

        .sidebar-subtitle, .detail-subtitle {
            font-size: 12px;
            font-weight: 400;
            color: #636466;
            margin-top: 2px;
            word-break: break-all;
            line-height: 1.4;
        }

        .sidebar-footer, .detail-footer {
            position: sticky;
            bottom: 0;
            background-color: #f8f9fa;
            border-top: 1px solid #e3e3e3;
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .footer-stats {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .parent-domain-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #636466;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #bccbcb;
            transition: all 0.2s ease;
            background: white;
            margin-bottom: 8px;
        }

        .parent-domain-toggle:hover {
            border-color: #594ef3;
            background-color: #f8f7ff;
        }

        .parent-domain-toggle input[type="checkbox"] {
            margin: 0;
            accent-color: #594ef3;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #636466;
        }

        .stat-value {
            font-weight: 600;
            color: #594ef3;
        }

        .sidebar-search {
            padding: 12px;
            border-bottom: 1px solid #e3e3e3;
            position: relative;
        }

        .sidebar-search .material-symbols-outlined {
            position: absolute;
            left: 22px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: #8d9a9e;
            pointer-events: none;
        }

        .sidebar-search input {
            width: 100%;
            padding: 8px 10px 8px 36px;
            border: 1px solid #bccbcb;
            border-radius: 4px;
            font-size: 13px;
        }

        .sidebar-search input:focus {
            outline: none;
            border-color: #594ef3;
            box-shadow: 0 0 0 2px rgba(89, 78, 243, 0.1);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .sidebar-item {
            padding: 12px;
            border: 1px solid #e3e3e3;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background-color: white;
        }

        .sidebar-item:hover {
            background-color: #f8f7ff;
            border-color: #594ef3;
            transform: translateX(2px);
        }

        .sidebar-item.selected {
            background-color: #f8f7ff;
            border-color: #594ef3;
            border-width: 2px;
            box-shadow: 0 2px 8px rgba(89, 78, 243, 0.15);
        }

        .item-domain {
            font-weight: 500;
            color: #231f20;
            font-size: 14px;
            margin-bottom: 6px;
            word-break: break-all;
        }

        .item-stats {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 8px;
        }

        .item-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #636466;
        }

        .item-badge .material-symbols-outlined {
            font-size: 16px;
            color: #594ef3;
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 20;
        }

        .item-badge svg {
            width: 16px;
            height: 16px;
            fill: #594ef3;
        }

        .item-badge strong {
            color: #231f20;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #8d9a9e;
        }

        .empty-state .material-symbols-outlined {
            font-size: 48px;
            color: #e3e3e3;
            margin-bottom: 16px;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            fill: #e3e3e3;
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 14px;
            font-style: italic;
        }

        .loading-spinner {
            text-align: center;
            padding: 30px 20px;
            color: #594ef3;
        }

        .loading-spinner .material-symbols-outlined {
            font-size: 32px;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-top: 12px;
            font-size: 13px;
            font-weight: 500;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .pagination-btn {
            background: linear-gradient(135deg, #594ef3 0%, #512b70 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(89, 78, 243, 0.3);
        }

        .pagination-btn:disabled {
            background: #e3e3e3;
            color: #8d9a9e;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: 12px;
            color: #636466;
            font-weight: 500;
        }

        .page-size-select {
            padding: 4px 8px;
            border: 1px solid #bccbcb;
            border-radius: 4px;
            font-size: 11px;
            background-color: white;
            color: #636466;
            cursor: pointer;
            margin-left: 8px;
        }

        .page-size-select:focus {
            outline: none;
            border-color: #594ef3;
        }

        /* Detail Pane */
        .detail-pane {
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .detail-header {
            padding: 8px 10px;
            border-bottom: 1px solid #e3e3e3;
            background-color: #f8f9fa;
        }

        .detail-title {
            font-size: 14px;
            font-weight: 600;
            color: #231f20;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-title svg {
            width: 18px;
            height: 18px;
            fill: #594ef3;
        }

        .detail-toolbar {
            padding: 14px 10px 13px 10px;
            border-bottom: 1px solid #e3e3e3;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .password-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #636466;
            cursor: pointer;
            padding: 6px 12px;
            border: 1px solid #bccbcb;
            border-radius: 4px;
            background-color: white;
            transition: all 0.2s;
        }

        .password-toggle:hover {
            border-color: #594ef3;
            background-color: #f8f7ff;
        }

        .password-toggle input[type="checkbox"] {
            margin: 0;
            accent-color: #594ef3;
        }

        .export-btn {
            padding: 6px 14px;
            border: 1px solid #bccbcb;
            border-radius: 4px;
            font-size: 13px;
            background-color: white;
            color: #37315b;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .export-btn:hover {
            border-color: #594ef3;
            background-color: #f8f7ff;
            color: #594ef3;
        }

        .export-btn .material-symbols-outlined {
            font-size: 16px;
        }

        .detail-search {
            flex: 1;
            max-width: 300px;
            position: relative;
        }

        .detail-search .material-symbols-outlined {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: #8d9a9e;
            pointer-events: none;
        }

        .detail-search input {
            width: 100%;
            padding: 6px 10px 6px 36px;
            border: 1px solid #bccbcb;
            border-radius: 4px;
            font-size: 13px;
        }

        .detail-search input:focus {
            outline: none;
            border-color: #594ef3;
            box-shadow: 0 0 0 2px rgba(89, 78, 243, 0.1);
        }

        .detail-content {
            flex: 1;
            overflow-y: auto;
        }

        /* Table Styles */
        .credentials-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .credentials-table thead {
            background-color: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .credentials-table th {
            text-align: left;
            padding: 12px;
            font-weight: 600;
            color: #636466;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e3e3e3;
        }

        .credentials-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            color: #231f20;
        }

        .credentials-table tbody tr {
            transition: background-color 0.2s;
        }

        .credentials-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .password-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .password-value {
            font-family: monospace;
            flex: 1;
        }

        .password-value.masked {
            letter-spacing: 2px;
        }

        .toggle-password-btn {
            background: none;
            border: none;
            color: #8d9a9e;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .toggle-password-btn:hover {
            background-color: #f0f0f0;
            color: #594ef3;
        }

        .toggle-password-btn .material-symbols-outlined {
            font-size: 18px;
        }

        .source-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: capitalize;
        }

        .source-telegram {
            background-color: #e3f2fd;
            color: #0d47a1;
        }

        .source-discord {
            background-color: #ede7f6;
            color: #4527a0;
        }

        .source-other {
            background-color: #f0f0f0;
            color: #636466;
        }

        .view-json-btn {
            padding: 4px 10px;
            background-color: #f8f9fa;
            border: 1px solid #e3e3e3;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            color: #594ef3;
            font-weight: 500;
        }

        .view-json-btn:hover {
            background-color: #594ef3;
            color: white;
            border-color: #594ef3;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 0;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            overflow: hidden;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: linear-gradient(135deg, #594ef3 0%, #512b70 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-header h2 svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
        }

        .modal-body input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 14px;
            border: 2px solid #e3e3e3;
            border-radius: 6px;
            outline: none;
            transition: border-color 0.3s;
        }

        .modal-body input[type="text"]:focus {
            border-color: #594ef3;
            box-shadow: 0 0 0 3px rgba(89, 78, 243, 0.1);
        }

        .api-key-help {
            margin-top: 12px;
            font-size: 12px;
            color: #8d9a9e;
        }

        .credential-owners-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background-color: white;
            border: 1px solid #bccbcb;
            border-radius: 4px;
            font-size: 14px;
            color: #231f20;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 200px;
            height: 34px;
            box-sizing: border-box;
        }

        .credential-owners-btn:hover {
            background-color: #f8f7ff;
            border-color: #594ef3;
        }

        .credential-owners-btn .material-symbols-outlined {
            font-size: 18px;
            color: #594ef3;
        }

        .credential-owners-btn svg {
            width: 18px;
            height: 18px;
            fill: #8d9a9e;
        }

        .owners-modal-help {
            margin-bottom: 16px;
            font-size: 13px;
            color: #636466;
            line-height: 1.5;
        }

        #ownersTextarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e3e3e3;
            border-radius: 6px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
            outline: none;
            transition: border-color 0.3s;
        }

        #ownersTextarea:focus {
            border-color: #594ef3;
            box-shadow: 0 0 0 3px rgba(89, 78, 243, 0.1);
        }

        .owners-modal-preview {
            margin-top: 16px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
            font-size: 13px;
        }

        .owners-modal-preview strong {
            color: #231f20;
            display: block;
            margin-bottom: 8px;
        }

        #ownersPreviewList {
            color: #636466;
            line-height: 1.8;
        }

        .owner-domain-item {
            display: inline-block;
            padding: 4px 10px;
            margin: 4px 4px 4px 0;
            background-color: #e8e6ff;
            color: #594ef3;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .secondary-btn {
            padding: 10px 24px;
            background: white;
            color: #636466;
            border: 1px solid #e3e3e3;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .secondary-btn:hover {
            background-color: #f8f9fa;
            border-color: #594ef3;
            color: #594ef3;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e3e3e3;
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .modal-footer button {
            padding: 10px 24px;
            background: linear-gradient(135deg, #594ef3 0%, #512b70 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .modal-footer button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(89, 78, 243, 0.3);
        }

        /* JSON Modal */
        .json-content {
            background-color: #f8f9fa;
            border: 1px solid #e3e3e3;
            border-radius: 6px;
            padding: 16px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            body.global-mode .main-container {
                grid-template-columns: 250px 250px 1fr;
            }
        }

        @media (max-width: 900px) {
            body.global-mode .main-container {
                grid-template-columns: 1fr;
            }

            body.search-mode .main-container {
                grid-template-columns: 1fr;
            }

            .sidebar-left, .sidebar-center {
                display: none;
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                width: 100%;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-muted {
            color: #8d9a9e;
        }

        .text-truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>
<body class="global-mode">
    <!-- API Key Modal -->
    <div id="apiKeyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <span class="material-symbols-outlined">key</span>
                    Enter API Key
                </h2>
                <button class="modal-close" id="closeApiKeyModal">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="text" id="apiKeyInput" placeholder="Enter your API key">
                <div class="api-key-help">
                    Enter only the API key value (do not include "Token" in the input)<br>
                    <strong>Note:</strong> API key is only stored for this session and will be cleared on page refresh.
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveApiKeyBtn">Save API Key</button>
            </div>
        </div>
    </div>

    <!-- JSON View Modal -->
    <div id="jsonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <span class="material-symbols-outlined">code</span>
                    Credential Details (JSON)
                </h2>
                <button class="modal-close" id="closeJsonModal">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="jsonContent" class="json-content"></div>
            </div>
            <div class="modal-footer">
                <button id="copyJsonBtn">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <!-- Credential Owners Modal -->
    <div id="credentialOwnersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg>
                    Credential Owner Domains
                </h2>
                <button class="modal-close" id="closeOwnersModal">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="owners-modal-help">
                    Enter domain names separated by commas or new lines. These are the organizations whose credentials you want to search for.
                </div>
                <textarea id="ownersTextarea" placeholder="e.g., mycompany.com, vendor1.com, vendor2.com" rows="8"></textarea>
                <div class="owners-modal-preview" id="ownersPreview">
                    <strong>Domains to search:</strong>
                    <div id="ownersPreviewList"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="clearOwnersBtn" class="secondary-btn">Clear All</button>
                <button id="saveOwnersBtn">Save Domains</button>
            </div>
        </div>
    </div>

    <!-- Global View Help Modal -->
    <div id="globalHelpModal" class="modal">
        <div class="modal-content help-modal-content">
            <div class="modal-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#594ef3"><path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
                    Global View Help
                </h2>
                <button class="modal-close" id="closeGlobalHelpModal">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body help-modal-body">
                <section class="help-section">
                    <h3>What is Global View?</h3>
                    <p>Global View helps you discover <strong>where YOUR organization's credentials are exposed across the entire internet</strong>. Use this mode for first-party risk assessment to identify all breach sources affecting your employees.</p>
                </section>

                <section class="help-section">
                    <h3>When to Use Global View</h3>
                    <ul>
                        <li><strong>Proactive Security:</strong> Discover all sites where your employee credentials have been leaked</li>
                        <li><strong>Incident Response:</strong> Quickly assess the full scope of a credential compromise</li>
                        <li><strong>Risk Assessment:</strong> Understand your organization's overall credential exposure</li>
                        <li><strong>Remediation Planning:</strong> Export data for password reset campaigns</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h3>Three-Panel Workflow</h3>
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Breached Domains (Left Panel)</h4>
                                <p>Enter the <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="#594ef3" style="vertical-align: middle; margin: 0 4px;"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg><strong>Credential Owner Domain</strong> (the organization whose credentials you want to find, e.g., <code>mycompany.com</code>) and click <strong>Search</strong>.</p>
                                <p>View all <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="#594ef3" style="vertical-align: middle; margin: 0 4px;"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg><strong>Breached Domains</strong> (external sites/services where your credentials were found). Each shows the number of affected subdomains and total exposed credentials.</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Subdomains (Center Panel)</h4>
                                <p>Click any breached domain to see its subdomains containing your credentials.</p>
                                <p>Use the <strong>"Use Parent Domain"</strong> checkbox to view credentials for the main domain itself.</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Credentials (Right Panel)</h4>
                                <p>Click any subdomain to see the actual exposed credentials (email/username, password, leak date, source).</p>
                                <p>Export to CSV/JSON for remediation. Use the <strong>"Exclude Subdomains"</strong> toggle to filter results.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>Key Features</h3>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <strong>Date Filtering</strong>
                            <p>Focus on recent leaks using Date From/To filters</p>
                        </div>
                        <div class="feature-item">
                            <strong>Exclude Subdomains</strong>
                            <p>Toggle to show only exact domain matches</p>
                        </div>
                        <div class="feature-item">
                            <strong>Pagination</strong>
                            <p>Navigate through large datasets with adjustable page sizes</p>
                        </div>
                        <div class="feature-item">
                            <strong>Export Options</strong>
                            <p>Download CSV or JSON for analysis and remediation</p>
                        </div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>Example Use Case</h3>
                    <div class="example-box">
                        <p><strong>Scenario:</strong> Discover where your organization's credentials are exposed</p>
                        <ol>
                            <li><svg xmlns="http://www.w3.org/2000/svg" height="14px" viewBox="0 -960 960 960" width="14px" fill="#594ef3" style="vertical-align: middle; margin-right: 4px;"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg>Enter Credential Owner: <code>mycompany.com</code></li>
                            <li><svg xmlns="http://www.w3.org/2000/svg" height="14px" viewBox="0 -960 960 960" width="14px" fill="#594ef3" style="vertical-align: middle; margin-right: 4px;"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg>See: 15 Breached Domains found (google.com, facebook.com, discord.com, etc.)</li>
                            <li>Click breached domain: <code>google.com</code></li>
                            <li>See: 8 subdomains (gmail.com, accounts.google.com, etc.)</li>
                            <li>Click subdomain: <code>accounts.google.com</code></li>
                            <li>See: 23 mycompany.com credentials exposed in various breaches</li>
                            <li>Export: CSV for IT team to coordinate password resets</li>
                        </ol>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Search View Help Modal -->
    <div id="searchHelpModal" class="modal">
        <div class="modal-content help-modal-content">
            <div class="modal-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#594ef3"><path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
                    Search View Help
                </h2>
                <button class="modal-close" id="closeSearchHelpModal">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body help-modal-body">
                <section class="help-section">
                    <h3>What is Search View?</h3>
                    <p>Search View enables <strong>targeted investigation of specific domains</strong> to find credentials from your organization and vendors. Use this mode for third-party risk assessment and focused security investigations.</p>
                </section>

                <section class="help-section">
                    <h3>When to Use Search View</h3>
                    <ul>
                        <li><strong>Vendor Risk Assessment:</strong> Investigate if your vendors' credentials are exposed on critical platforms</li>
                        <li><strong>Supply Chain Security:</strong> Monitor multiple third-party organizations simultaneously</li>
                        <li><strong>Targeted Investigation:</strong> Focus on a specific service or platform (e.g., Salesforce, Office 365)</li>
                        <li><strong>Security Reviews:</strong> Gather evidence for vendor security assessments</li>
                    </ul>
                </section>

                <section class="help-section">
                    <h3>Two-Panel Workflow</h3>
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Setup Your Search</h4>
                                <p><svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="#594ef3" style="vertical-align: middle; margin: 0 4px;"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg><strong>Target Domain:</strong> Enter the site/service you want to investigate (e.g., <code>salesforce.com</code>, <code>google.com</code>)</p>
                                <p><svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="#594ef3" style="vertical-align: middle; margin: 0 4px;"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg><strong>Credential Owner(s):</strong> Click to add one or more organizations whose credentials you want to find (e.g., <code>mycompany.com, vendor1.com, vendor2.com</code>)</p>
                                <p>Click <strong>Search</strong> to run the investigation.</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Subdomains (Left Panel)</h4>
                                <p>View all subdomains of your <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="#594ef3" style="vertical-align: middle; margin: 0 4px;"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg><strong>Target Domain</strong> that contain credentials from your specified <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="#594ef3" style="vertical-align: middle; margin: 0 4px;"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg><strong>Credential Owners</strong>.</p>
                                <p>Use the <strong>"Use Parent Domain"</strong> checkbox to view credentials for the main domain itself.</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Credentials (Right Panel)</h4>
                                <p>Click any subdomain to see exposed credentials from ALL specified credential owners.</p>
                                <p>Export to CSV/JSON for reporting and remediation.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>Key Features</h3>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <strong>Multiple Owners</strong>
                            <p>Search for credentials from multiple organizations at once</p>
                        </div>
                        <div class="feature-item">
                            <strong>Date Filtering</strong>
                            <p>Focus on specific time periods</p>
                        </div>
                        <div class="feature-item">
                            <strong>Exclude Subdomains</strong>
                            <p>Toggle to show only exact domain matches</p>
                        </div>
                        <div class="feature-item">
                            <strong>Export Options</strong>
                            <p>Download CSV or JSON for analysis</p>
                        </div>
                    </div>
                </section>

                <section class="help-section">
                    <h3>Example Use Case</h3>
                    <div class="example-box">
                        <p><strong>Scenario:</strong> Vendor security assessment</p>
                        <ol>
                            <li><svg xmlns="http://www.w3.org/2000/svg" height="14px" viewBox="0 -960 960 960" width="14px" fill="#594ef3" style="vertical-align: middle; margin-right: 4px;"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg>Enter Target Domain: <code>salesforce.com</code></li>
                            <li><svg xmlns="http://www.w3.org/2000/svg" height="14px" viewBox="0 -960 960 960" width="14px" fill="#594ef3" style="vertical-align: middle; margin-right: 4px;"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg>Enter Credential Owners: <code>mycompany.com, criticalvendor.com, vendor3.com</code></li>
                            <li>See: 12 subdomains of salesforce.com with credentials from these owners</li>
                            <li>Click subdomain: <code>login.salesforce.com</code></li>
                            <li>See: 15 credentials total (8 from mycompany.com, 5 from criticalvendor.com, 2 from vendor3.com)</li>
                            <li>Export: Evidence for vendor security review and risk scoring</li>
                        </ol>
                    </div>
                </section>

                <section class="help-section">
                    <h3>Tips & Best Practices</h3>
                    <ul>
                        <li>Use comma-separated or newline-separated domains in the Credential Owner(s) modal</li>
                        <li>Compare credential exposure across multiple vendors to identify highest-risk partners</li>
                        <li>Export results to support vendor risk scoring and security requirements</li>
                        <li>Combine with date filters to track improvement or deterioration over time</li>
                    </ul>
                </section>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-row">
            <div class="header-left">
                <div class="logo">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 830.5 216" style="enable-background:new 0 0 830.5 216;" xml:space="preserve">
                        <style type="text/css">
                            .st14{fill:#673EF3;}
                            .st56{fill:#001522;}
                        </style>
                        <g>
                            <g>
                                <g>
                                    <path class="st56" d="M226,62.7h19.7c0.1,9.7,7.5,15.8,20.5,15.8c10.7,0,17.1-4.2,17.1-11.4c0-8.5-9.1-10.2-19.7-11.9 c-15.6-2.2-36.7-5-36.7-26.4c0-17.1,14.1-28.2,36.8-28.2c23,0,37.7,12.2,37.7,30.8h-19.1c0.1-9.6-6.9-15.1-18.1-15.1 c-10.5,0-16.6,4.4-16.6,11c0,8.6,10,10.1,21.2,11.7c15.6,2.4,35.2,5.7,35.2,26.8c0,17.2-14.8,28.3-38.4,28.3 C241.4,94.2,226.1,81.6,226,62.7z"/>
                                    <path class="st56" d="M308.8,59.4c0-20,14.6-33.4,35.2-33.4c20.3,0,34.3,13.6,34.3,33.7c0,1.6,0,4.2-0.2,5.6h-50.1 c1.5,9,7.9,14.8,17,14.8c7.1,0,12.6-3.5,15.3-8.7l15.7,4c-4,11.5-16.3,18.5-31.8,18.5C323.4,93.9,308.8,80,308.8,59.4z M359.4,53.8c-1.1-8.1-7.4-14.1-16-14.1c-8.4,0-14.2,5.6-15.7,14.1H359.4z"/>
                                    <path class="st56" d="M382.8,59.9c0-20.3,14.1-33.9,34.7-33.9c17.3,0,30.6,9.7,32.7,24.8l-17.2,2.2c-1.6-7-8.1-11.8-15.2-11.8 c-9.4,0-16.5,7.7-16.5,18.7s7,18.7,16.3,18.7c7.4,0,13.6-4.9,15.3-11.7l17.3,2.1c-2.4,15.1-15.7,24.8-32.8,24.8 C397.1,93.9,382.8,80.2,382.8,59.9z"/>
                                    <path class="st56" d="M518.5,91.9H500v-9h-1.2c-4.7,7.2-10.9,10.9-18.6,10.9c-14.5,0-24.1-11.2-24.1-26.6V28h18.5v36.5 c0,7.9,4.5,13.3,12,13.3c7.4,0,13.5-5.9,13.5-14V28h18.5V91.9z"/>
                                    <path class="st56" d="M528.2,28h18.2v8.7h1.4c2.7-6,9-10,15.7-10c2.6,0,5.2,0.6,7.2,1.6V45c-3.6-1.6-7.9-2.4-10.5-2.4 c-8.1,0-13.6,6.7-13.6,16.6v32.7h-18.5V28z"/>
                                    <path class="st56" d="M574.8,10.9c0-6.2,4.6-10.9,11.1-10.9c6.5,0,11.1,4.6,11.1,10.9c0,6.4-4.6,10.9-11.1,10.9 C579.5,21.7,574.8,17.2,574.8,10.9z M576.7,28h18.5v63.9h-18.5V28z"/>
                                    <path class="st56" d="M610.3,71.3V41.5h-9V28h9.5l3.6-20.2h14.5L628.7,28h14.6v13.5h-14.6v29.1c0,5.4,3.2,9,8.5,9 c1.7,0,4.5-0.4,6.6-0.9v13.2c-3.6,1.2-8.9,2-12.5,2C618.5,93.9,610.3,84.8,610.3,71.3z"/>
                                    <path class="st56" d="M653.5,118.4l0.1-14.8c2.7,1.1,6.6,1.9,9.5,1.9c8.1,0,11.1-6.9,13.6-13L646.7,28h19.8l17.1,40.8h1.2 L698.7,28h19.2l-24.7,66.1c-6,16.2-12.7,26.6-26.4,26.6C662.7,120.7,657,119.8,653.5,118.4z"/>
                                </g>
                                <g>
                                    <path class="st56" d="M226,183.6h19.7c0.1,9.7,7.5,15.8,20.5,15.8c10.7,0,17.1-4.2,17.1-11.4c0-8.5-9.1-10.2-19.7-11.9 c-15.6-2.2-36.7-5-36.7-26.4c0-17.1,14.1-28.2,36.8-28.2c23,0,37.7,12.2,37.7,30.8h-19.1c0.1-9.6-6.9-15.1-18.1-15.1 c-10.5,0-16.6,4.4-16.6,11c0,8.6,10,10.1,21.2,11.7c15.6,2.4,35.2,5.7,35.2,26.8c0,17.2-14.8,28.3-38.4,28.3 C241.4,215.1,226.1,202.5,226,183.6z"/>
                                    <path class="st56" d="M308.8,180.8c0-20.3,14.1-33.9,34.7-33.9c17.3,0,30.6,9.7,32.7,24.8l-17.2,2.2c-1.6-7-8.1-11.8-15.2-11.8 c-9.4,0-16.5,7.7-16.5,18.7s7,18.7,16.3,18.7c7.4,0,13.6-4.9,15.3-11.7l17.3,2.1c-2.4,15.1-15.7,24.8-32.8,24.8 C323.1,214.8,308.8,201,308.8,180.8z"/>
                                    <path class="st56" d="M380.6,180.8c0-20.6,14.1-33.9,35.4-33.9c21.2,0,35.4,13.3,35.4,33.9c0,20.7-14.2,33.9-35.4,33.9 C394.7,214.8,380.6,201.4,380.6,180.8z M432.9,180.8c0-10.6-7-18.1-16.8-18.1c-10,0-17,7.5-17,18.1s7,18.2,17,18.2 C425.9,199.1,432.9,191.4,432.9,180.8z"/>
                                    <path class="st56" d="M458.2,148.9h18.2v8.7h1.4c2.7-6,9-10,15.7-10c2.6,0,5.2,0.6,7.2,1.6v16.6c-3.6-1.6-7.9-2.4-10.5-2.4 c-8.1,0-13.6,6.7-13.6,16.6v32.7h-18.5V148.9z"/>
                                    <path class="st56" d="M501.8,180.3c0-20,14.6-33.4,35.2-33.4c20.3,0,34.3,13.6,34.3,33.7c0,1.6,0,4.2-0.2,5.6h-50.1 c1.5,9,7.9,14.8,17,14.8c7.1,0,12.6-3.5,15.3-8.7l15.7,4c-4,11.5-16.3,18.5-31.8,18.5C516.3,214.8,501.8,200.9,501.8,180.3z M552.4,174.7c-1.1-8.1-7.4-14.1-16-14.1c-8.4,0-14.2,5.6-15.7,14.1H552.4z"/>
                                    <path class="st56" d="M575.7,180.8c0-20.3,14.1-33.9,34.7-33.9c17.3,0,30.6,9.7,32.7,24.8l-17.2,2.2c-1.6-7-8.1-11.8-15.2-11.8 c-9.4,0-16.5,7.7-16.5,18.7s7,18.7,16.3,18.7c7.4,0,13.6-4.9,15.3-11.7l17.3,2.1c-2.4,15.1-15.7,24.8-32.8,24.8 C590.1,214.8,575.7,201,575.7,180.8z"/>
                                    <path class="st56" d="M645.9,196.1c0-12,10.1-19.3,30.2-21.8l13.6-1.6V170c0-6.1-4.2-10.2-11.6-10.2c-6.7,0-11.4,3.7-11.2,10.1 h-18.1c0-14,11.6-23,29.6-23c18.2,0,29.8,9.2,29.8,23.7v42.2h-18.5v-8.1h-1.2c-4,6.4-11.4,9.7-20.5,9.7 C654.9,214.4,645.9,207.5,645.9,196.1z M689.7,188.3v-4.5l-13.1,1.6c-9.1,1.1-12.6,4.7-12.6,9.1c0,4.7,3.7,7.7,10.1,7.7 C683.4,202.3,689.7,196.3,689.7,188.3z"/>
                                    <path class="st56" d="M716.9,148.9h18.2v8.7h1.4c2.7-6,9-10,15.7-10c2.6,0,5.2,0.6,7.2,1.6v16.6c-3.6-1.6-7.9-2.4-10.5-2.4 c-8.1,0-13.6,6.7-13.6,16.6v32.7h-18.5V148.9z"/>
                                    <path class="st56" d="M760.4,180.8c0-20.2,12.7-33.9,30.1-33.9c8.9,0,15.8,3.6,20.3,10h1.2v-36.7h18.5v92.6h-18.5v-8.1h-1.2 c-4.5,6.5-11.2,10.1-20.2,10.1C773,214.8,760.4,201.2,760.4,180.8z M812.7,180.8c0-10.2-7-18.1-16.8-18.1c-9.9,0-17,7.9-17,18.1 c0,10.4,7.2,18.2,17,18.2C805.7,199.1,812.7,191.1,812.7,180.8z"/>
                                </g>
                            </g>
                            <g>
                                <polygon class="st14" points="147.6,32.1 147.6,32.1 132.1,41.1 108.8,54.5 132.1,68 147.6,76.9 186.4,99.4 186.4,54.5"/>
                                <polygon class="st14" points="93.2,0.7 54.4,23.1 54.4,23.1 54.4,41.1 54.4,68 77.7,54.5 93.2,45.5 93.2,45.5 132.1,23.1"/>
                                <polygon class="st14" points="0,54.5 0,99.4 0,99.4 15.5,108.3 38.8,121.8 38.8,94.9 38.8,76.9 38.8,32.1"/>
                                <polygon class="st14" points="54.4,148.7 38.8,139.7 0,117.3 0,162.2 38.8,184.6 38.8,184.6 54.4,175.6 77.7,162.2"/>
                                <polygon class="st14" points="108.8,162.2 93.2,171.1 54.4,193.6 93.2,216 132.1,193.6 132.1,193.6 132.1,175.6 132.1,148.7"/>
                                <polygon class="st14" points="170.9,108.3 147.6,94.9 147.6,121.8 147.6,139.7 147.6,184.6 186.4,162.2 186.4,117.3 186.4,117.3"/>
                                <polygon class="st14" points="112.6,142 132.1,130.8 132.1,85.9 93.2,63.5 54.4,85.9 54.4,130.8 93.2,153.2"/>
                            </g>
                        </g>
                    </svg>
                </div>
                <h1>Exposed Credentials</h1>
            </div>
            <div class="header-right">
                <div class="mode-toggle">
                    <button id="globalModeBtn" class="active">Global View</button>
                    <button id="searchModeBtn">Search View</button>
                </div>
                <button class="header-button" id="addApiKeyBtn">
                    <span class="material-symbols-outlined">key</span>
                    Add API Key
                </button>
                <button class="header-button help-button" id="helpBtn" title="View Help">
                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="currentColor"><path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
                </button>
            </div>
        </div>
        
        <div class="header-row filter-bar">
            <div class="filter-controls">
                <!-- Global View Filters -->
                <div id="globalFilters" class="filter-controls">
                    <div class="filter-group">
                        <label class="filter-label">Credential Owner Domain</label>
                        <div class="filter-input-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg>
                            <input type="text" id="credentialOwnerInput" placeholder="e.g., mycompany.com">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Date From</label>
                        <input type="date" id="dateFromInput">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Date To</label>
                        <input type="date" id="dateToInput">
                    </div>
                    <button class="action-button" id="loadGlobalBtn">
                        <span class="material-symbols-outlined">search</span>
                        Search
                    </button>
                </div>

                <!-- Search View Filters -->
                <div id="searchFilters" class="filter-controls hidden">
                    <div class="filter-group">
                        <label class="filter-label">Target Domain</label>
                        <div class="filter-input-wrapper">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg>
                            <input type="text" id="targetDomainInput" placeholder="e.g., vendor.com">
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Credential Owner(s)</label>
                        <button type="button" class="credential-owners-btn" id="openOwnersModalBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M80-120v-720h400v160h400v320h-80v-240H480v80h80v80h-80v80h80v80h-80v80h160v80H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80ZM800-40v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM640-440v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg>
                            <span id="ownersCountText">Add Domains</span>
                        </button>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Date From</label>
                        <input type="date" id="searchDateFromInput">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Date To</label>
                        <input type="date" id="searchDateToInput">
                    </div>
                    <button class="action-button" id="searchBtn">
                        <span class="material-symbols-outlined">search</span>
                        Search
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Sidebar: Breached Domains (Global View Only) -->
        <div class="sidebar-left">
            <div class="sidebar-header">
                <div class="sidebar-title">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg>
                    Breached Domains
                </div>
                <div class="sidebar-subtitle" id="globalSubtitle">—</div>
            </div>
            <div class="sidebar-search">
                <span class="material-symbols-outlined">search</span>
                <input type="text" id="breachedSitesSearch" placeholder="Search breached domains...">
            </div>
            <div class="sidebar-content" id="breachedSitesList">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg>
                    <div class="empty-state-text">Enter a credential owner domain and click Search to see breached domains</div>
                </div>
            </div>
            <div class="sidebar-footer" id="globalFooter" style="display: none;">
                <div class="footer-stats" id="globalStats">
                    <div class="stat-item">
                        <span>Total Domains:</span>
                        <span class="stat-value" id="totalSites">—</span>
                    </div>
                    <div class="stat-item">
                        <span>Total Credentials:</span>
                        <span class="stat-value" id="totalGlobalCredentials">—</span>
                    </div>
                </div>
                <div class="footer-pagination" id="globalPagination" style="display: none;">
                    <button class="pagination-btn" id="globalPrevBtn">
                        <span class="material-symbols-outlined">chevron_left</span>
                        Prev
                    </button>
                    <span class="pagination-info" id="globalPageInfo">Page 1</span>
                    <button class="pagination-btn" id="globalNextBtn">
                        Next
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                    <select id="globalPageSizeSelect" class="page-size-select">
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100" selected>100</option>
                        <option value="500">500</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Center Sidebar: Parent Domains -->
        <div class="sidebar-center">
            <div class="sidebar-header">
                <div class="sidebar-title">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg>
                    Subdomains
                </div>
                <div class="sidebar-subtitle" id="parentSubtitle">—</div>
            </div>
            <div class="sidebar-search">
                <span class="material-symbols-outlined">search</span>
                <input type="text" id="subdomainsSearch" placeholder="Search subdomains...">
            </div>
            <div class="sidebar-content" id="subdomainsList">
                <div class="empty-state">
                    <span class="material-symbols-outlined">arrow_back</span>
                    <div class="empty-state-text" id="subdomainsEmptyText">
                        <span class="global-mode-text">Select a breached domain from the left</span>
                        <span class="search-mode-text hidden">Enter target and credential owners, then click Search</span>
                    </div>
                </div>
            </div>
            <div class="sidebar-footer" id="parentFooter" style="display: none;">
                <label class="parent-domain-toggle">
                    <input type="checkbox" id="useParentDomainToggle">
                    <span>Use Parent Domain</span>
                </label>
                <div class="footer-stats" id="parentStats">
                    <div class="stat-item">
                        <span>Total Subdomains:</span>
                        <span class="stat-value" id="totalSubdomains">—</span>
                    </div>
                </div>
                <div class="footer-pagination" id="parentPagination" style="display: none;">
                    <button class="pagination-btn" id="parentPrevBtn">
                        <span class="material-symbols-outlined">chevron_left</span>
                        Prev
                    </button>
                    <span class="pagination-info" id="parentPageInfo">Page 1</span>
                    <button class="pagination-btn" id="parentNextBtn">
                        Next
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                    <select id="parentPageSizeSelect" class="page-size-select">
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100" selected>100</option>
                        <option value="500">500</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Right Detail Pane: Credentials -->
        <div class="detail-pane">
            <div class="detail-header" id="detailHeader">
                <div class="detail-title">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M120-160v-112q0-34 17.5-62.5T184-378q62-31 126-46.5T440-440q20 0 40 1.5t40 4.5q-4 58 21 109.5t73 84.5v80H120ZM760-40l-60-60v-186q-44-13-72-49.5T600-420q0-58 41-99t99-41q58 0 99 41t41 99q0 45-25.5 80T790-290l50 50-60 60 60 60-80 80ZM440-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm300 80q17 0 28.5-11.5T780-440q0-17-11.5-28.5T740-480q-17 0-28.5 11.5T700-440q0 17 11.5 28.5T740-400Z"/></svg>
                    Credentials
                </div>
                <div class="detail-subtitle" id="detailSubtitle">—</div>
            </div>
            <div class="detail-toolbar">
                <div class="toolbar-left">
                    <label class="password-toggle">
                        <input type="checkbox" id="excludeSubdomainsToggle">
                        <span>Exclude Subdomains</span>
                    </label>
                </div>
                <div class="toolbar-right">
                    <div class="detail-search">
                        <span class="material-symbols-outlined">search</span>
                        <input type="text" id="credentialsSearch" placeholder="Search credentials...">
                    </div>
                    <button class="export-btn" id="exportCsvBtn">
                        <span class="material-symbols-outlined">download</span>
                        CSV
                    </button>
                    <button class="export-btn" id="exportJsonBtn">
                        <span class="material-symbols-outlined">code</span>
                        JSON
                    </button>
                </div>
            </div>
            <div class="detail-content" id="detailContent">
                <div class="empty-state">
                    <span class="material-symbols-outlined">arrow_back</span>
                    <div class="empty-state-text">Select a subdomain to view credentials</div>
                </div>
            </div>
            <div class="detail-footer" id="credentialFooter" style="display: none;">
                <div class="footer-stats" id="credentialStats">
                    <div class="stat-item">
                        <span>Total Credentials:</span>
                        <span class="stat-value" id="totalCredentials">—</span>
                    </div>
                </div>
                <div class="footer-pagination" id="credentialsPagination" style="display: none;">
                    <button class="pagination-btn" id="credentialsPrevBtn">
                        <span class="material-symbols-outlined">chevron_left</span>
                        Prev
                    </button>
                    <span class="pagination-info" id="credentialsPageInfo">Page 1</span>
                    <button class="pagination-btn" id="credentialsNextBtn">
                        Next
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                    <select id="credentialsPageSizeSelect" class="page-size-select">
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100" selected>100</option>
                        <option value="500">500</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let apiKey = null;
        let currentMode = 'global'; // 'global' or 'search'
        
        // Global View State
        let globalSummaryData = [];
        let filteredGlobalData = [];
        let selectedTargetDomain = null;
        let globalCurrentPage = 1;
        let globalPageSize = 100;
        
        // Parent Domains State
        let parentDomainsData = [];
        let filteredParentData = [];
        let selectedSubdomain = null;
        let useParentDomainSelected = false;
        let parentCurrentPage = 1;
        let parentPageSize = 100;
        
        // Credentials State
        let credentialsData = [];
        let filteredCredentialsData = [];
        let credentialsCurrentPage = 1;
        let credentialsPageSize = 500;
        let excludeSubdomains = false;
        
        // Filters
        let credentialOwnerDomain = '';
        let dateFrom = '';
        let dateTo = '';
        
        // Search View State
        let targetDomain = '';
        let credentialOwners = [];

        const API_BASE_URL = 'https://platform-api.securityscorecard.io/v1';

        // API Key Modal
        document.getElementById('addApiKeyBtn').addEventListener('click', () => {
            document.getElementById('apiKeyModal').style.display = 'flex';
        });

        document.getElementById('closeApiKeyModal').addEventListener('click', () => {
            document.getElementById('apiKeyModal').style.display = 'none';
        });

        document.getElementById('saveApiKeyBtn').addEventListener('click', () => {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                apiKey = key;
                document.getElementById('apiKeyModal').style.display = 'none';
                alert('API Key saved successfully!');
            } else {
                alert('Please enter a valid API key');
            }
        });

        // Close modals on outside click
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Mode Toggle
        document.getElementById('globalModeBtn').addEventListener('click', () => {
            switchMode('global');
        });

        document.getElementById('searchModeBtn').addEventListener('click', () => {
            switchMode('search');
        });

        function switchMode(mode) {
            currentMode = mode;
            
            // Clear all views when switching modes FIRST
            resetGlobalView();
            resetParentView();
            resetDetailView();
            
            if (mode === 'global') {
                document.body.classList.remove('search-mode');
                document.body.classList.add('global-mode');
                document.getElementById('globalModeBtn').classList.add('active');
                document.getElementById('searchModeBtn').classList.remove('active');
                document.getElementById('globalFilters').classList.remove('hidden');
                document.getElementById('searchFilters').classList.add('hidden');
                
                // Toggle visibility for mode-specific text
                const globalTexts = document.querySelectorAll('.global-mode-text');
                const searchTexts = document.querySelectorAll('.search-mode-text');
                globalTexts.forEach(el => el.classList.remove('hidden'));
                searchTexts.forEach(el => el.classList.add('hidden'));
            } else {
                document.body.classList.remove('global-mode');
                document.body.classList.add('search-mode');
                document.getElementById('searchModeBtn').classList.add('active');
                document.getElementById('globalModeBtn').classList.remove('active');
                document.getElementById('globalFilters').classList.add('hidden');
                document.getElementById('searchFilters').classList.remove('hidden');
                
                // Toggle visibility for mode-specific text
                const globalTexts = document.querySelectorAll('.global-mode-text');
                const searchTexts = document.querySelectorAll('.search-mode-text');
                globalTexts.forEach(el => el.classList.add('hidden'));
                searchTexts.forEach(el => el.classList.remove('hidden'));
            }
        }
        
        function resetGlobalView() {
            document.getElementById('breachedSitesList').innerHTML = '<div class="empty-state"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M80-120v-720h400v160h400v560H80Zm80-80h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm0-160h80v-80h-80v80Zm160 480h320v-400H480v80h80v80h-80v80h80v80h-80v80Zm160-240v-80h80v80h-80Zm0 160v-80h80v80h-80Z"/></svg><div class="empty-state-text">Enter a credential owner domain and click Load to see breached domains</div></div>';
            document.getElementById('globalSubtitle').textContent = '—';
            document.getElementById('globalFooter').style.display = 'none';
            document.getElementById('breachedSitesSearch').value = '';
            document.getElementById('totalSites').textContent = '—';
            document.getElementById('totalGlobalCredentials').textContent = '—';
            globalSummaryData = [];
            filteredGlobalData = [];
            selectedTargetDomain = null;
            globalCurrentPage = 1;
        }

        // Global View: Load Button
        document.getElementById('loadGlobalBtn').addEventListener('click', async () => {
            credentialOwnerDomain = document.getElementById('credentialOwnerInput').value.trim();
            dateFrom = document.getElementById('dateFromInput').value;
            dateTo = document.getElementById('dateToInput').value;
            
            if (!credentialOwnerDomain) {
                alert('Please enter a credential owner domain');
                return;
            }
            
            if (!apiKey) {
                alert('Please add your API key first');
                document.getElementById('apiKeyModal').style.display = 'flex';
                return;
            }
            
            await loadGlobalSummary();
        });

        // Credential Owners Modal
        document.getElementById('openOwnersModalBtn').addEventListener('click', () => {
            // Populate textarea with current domains
            if (credentialOwners.length > 0) {
                document.getElementById('ownersTextarea').value = credentialOwners.join(', ');
            }
            document.getElementById('credentialOwnersModal').style.display = 'flex';
            updateOwnersPreview();
        });

        document.getElementById('closeOwnersModal').addEventListener('click', () => {
            document.getElementById('credentialOwnersModal').style.display = 'none';
        });

        document.getElementById('ownersTextarea').addEventListener('input', () => {
            updateOwnersPreview();
        });

        document.getElementById('clearOwnersBtn').addEventListener('click', () => {
            document.getElementById('ownersTextarea').value = '';
            updateOwnersPreview();
        });

        document.getElementById('saveOwnersBtn').addEventListener('click', () => {
            const textarea = document.getElementById('ownersTextarea').value;
            credentialOwners = textarea
                .split(/[\n,]+/)
                .map(d => d.trim())
                .filter(d => d);
            
            updateOwnersButtonText();
            document.getElementById('credentialOwnersModal').style.display = 'none';
        });

        // Help Button - Shows appropriate modal based on current mode
        document.getElementById('helpBtn').addEventListener('click', () => {
            if (currentMode === 'global') {
                document.getElementById('globalHelpModal').style.display = 'flex';
            } else {
                document.getElementById('searchHelpModal').style.display = 'flex';
            }
        });

        // Close Global Help Modal
        document.getElementById('closeGlobalHelpModal').addEventListener('click', () => {
            document.getElementById('globalHelpModal').style.display = 'none';
        });

        // Close Search Help Modal
        document.getElementById('closeSearchHelpModal').addEventListener('click', () => {
            document.getElementById('searchHelpModal').style.display = 'none';
        });

        function updateOwnersPreview() {
            const textarea = document.getElementById('ownersTextarea').value;
            const domains = textarea
                .split(/[\n,]+/)
                .map(d => d.trim())
                .filter(d => d);
            
            const previewList = document.getElementById('ownersPreviewList');
            if (domains.length === 0) {
                previewList.innerHTML = '<em style="color: #8d9a9e;">No domains entered yet</em>';
            } else {
                previewList.innerHTML = domains
                    .map(d => `<span class="owner-domain-item">${escapeHtml(d)}</span>`)
                    .join('');
            }
        }

        function updateOwnersButtonText() {
            const countText = document.getElementById('ownersCountText');
            if (credentialOwners.length === 0) {
                countText.textContent = 'Add Domains';
            } else if (credentialOwners.length === 1) {
                countText.textContent = `1 Domain`;
            } else {
                countText.textContent = `${credentialOwners.length} Domains`;
            }
        }

        // Search View: Search Button
        document.getElementById('searchBtn').addEventListener('click', async () => {
            targetDomain = document.getElementById('targetDomainInput').value.trim();
            dateFrom = document.getElementById('searchDateFromInput').value;
            dateTo = document.getElementById('searchDateToInput').value;
            
            if (!targetDomain) {
                alert('Please enter a target domain');
                return;
            }
            
            if (credentialOwners.length === 0) {
                alert('Please add at least one credential owner domain');
                return;
            }
            
            if (!apiKey) {
                alert('Please add your API key first');
                document.getElementById('apiKeyModal').style.display = 'flex';
                return;
            }
            
            // If "Use Parent Domain" is selected, load both parent domains and credentials in parallel
            if (useParentDomainSelected) {
                // Start both API calls in parallel (don't await yet)
                const parentDomainsPromise = loadParentDomains(targetDomain, credentialOwners, true); // true = skip auto-load credentials
                const credentialsPromise = loadCredentials(targetDomain, credentialOwners);
                
                // Wait for both to complete
                await Promise.all([parentDomainsPromise, credentialsPromise]);
                
                // Re-check the checkbox after both loads complete
                document.getElementById('useParentDomainToggle').checked = true;
            } else {
                // Normal flow: just load parent domains
                await loadParentDomains(targetDomain, credentialOwners);
            }
        });

        // API Calls
        async function loadGlobalSummary() {
            const list = document.getElementById('breachedSitesList');
            list.innerHTML = '<div class="loading-spinner"><span class="material-symbols-outlined">progress_activity</span><div class="loading-text">Loading breached domains...</div></div>';
            
            document.getElementById('globalSubtitle').textContent = credentialOwnerDomain;
            
            try {
                let url = `${API_BASE_URL}/exposed-credentials/summary?credential_owner_domain=${encodeURIComponent(credentialOwnerDomain)}&page=${globalCurrentPage}&size=${globalPageSize}`;
                
                if (dateFrom) url += `&date_from=${dateFrom}`;
                if (dateTo) url += `&date_to=${dateTo}`;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Token ${apiKey}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                globalSummaryData = data.entries || [];
                filteredGlobalData = [...globalSummaryData];
                
                // Update stats
                document.getElementById('totalSites').textContent = (data.total || 0).toLocaleString();
                const totalCreds = globalSummaryData.reduce((sum, item) => sum + (item.credentials_count || 0), 0);
                document.getElementById('totalGlobalCredentials').textContent = totalCreds.toLocaleString();
                
                // Show footer
                document.getElementById('globalFooter').style.display = 'flex';
                
                renderGlobalSummary();
                
                // Show/hide pagination
                if (data.total > globalPageSize) {
                    document.getElementById('globalPagination').style.display = 'flex';
                    updateGlobalPagination(data.total);
                } else {
                    document.getElementById('globalPagination').style.display = 'none';
                }
                
            } catch (error) {
                console.error('Error loading global summary:', error);
                list.innerHTML = `<div class="empty-state"><span class="material-symbols-outlined">error</span><div class="empty-state-text">Error loading data: ${error.message}</div></div>`;
                alert(`Error loading data: ${error.message}`);
            }
        }

        function renderGlobalSummary() {
            const list = document.getElementById('breachedSitesList');
            
            if (filteredGlobalData.length === 0) {
                list.innerHTML = '<div class="empty-state"><span class="material-symbols-outlined">search_off</span><div class="empty-state-text">No breached domains found</div></div>';
                return;
            }
            
            list.innerHTML = filteredGlobalData.map((item, index) => `
                <div class="sidebar-item" data-domain="${item.domain}" data-index="${index}">
                    <div class="item-domain">${escapeHtml(item.domain)}</div>
                    <div class="item-stats">
                        <span class="item-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M440-42v-80q-125-14-214.5-103.5T122-440H42v-80h80q14-125 103.5-214.5T440-838v-80h80v80q125 14 214.5 103.5T838-520h80v80h-80q-14 125-103.5 214.5T520-122v80h-80Zm40-158q116 0 198-82t82-198q0-116-82-198t-198-82q-116 0-198 82t-82 198q0 116 82 198t198 82Zm0-120q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T560-480q0-33-23.5-56.5T480-560q-33 0-56.5 23.5T400-480q0 33 23.5 56.5T480-400Zm0-80Z"/></svg>
                            <strong>${item.affected_subdomain_count || 0}</strong> subdomains
                        </span>
                        <span class="item-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M120-160v-112q0-34 17.5-62.5T184-378q62-31 126-46.5T440-440q20 0 40 1.5t40 4.5q-4 58 21 109.5t73 84.5v80H120ZM760-40l-60-60v-186q-44-13-72-49.5T600-420q0-58 41-99t99-41q58 0 99 41t41 99q0 45-25.5 80T790-290l50 50-60 60 60 60-80 80ZM440-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm300 80q17 0 28.5-11.5T780-440q0-17-11.5-28.5T740-480q-17 0-28.5 11.5T700-440q0 17 11.5 28.5T740-400Z"/></svg>
                            <strong>${item.credentials_count || 0}</strong> credentials
                        </span>
                    </div>
                </div>
            `).join('');
            
            // Add click handlers
            document.querySelectorAll('.sidebar-item[data-domain]').forEach(item => {
                item.addEventListener('click', async () => {
                    const domain = item.dataset.domain;
                    selectTargetDomain(domain, item);
                });
            });
        }

        async function selectTargetDomain(domain, itemElement) {
            // Highlight selected
            document.querySelectorAll('.sidebar-left .sidebar-item').forEach(el => el.classList.remove('selected'));
            itemElement.classList.add('selected');
            
            selectedTargetDomain = domain;
            const owners = [credentialOwnerDomain];
            
            // If "Use Parent Domain" is selected, load both parent domains and credentials in parallel
            if (useParentDomainSelected) {
                // Start both API calls in parallel (don't await yet)
                const parentDomainsPromise = loadParentDomains(domain, owners, true); // true = skip auto-load credentials
                const credentialsPromise = loadCredentials(domain, owners);
                
                // Wait for both to complete
                await Promise.all([parentDomainsPromise, credentialsPromise]);
                
                // Re-check the checkbox after both loads complete
                document.getElementById('useParentDomainToggle').checked = true;
            } else {
                // Normal flow: just load parent domains
                await loadParentDomains(domain, owners);
            }
        }

        async function loadParentDomains(target, owners, skipAutoLoadCredentials = false) {
            const list = document.getElementById('subdomainsList');
            list.innerHTML = '<div class="loading-spinner"><span class="material-symbols-outlined">progress_activity</span><div class="loading-text">Loading subdomains...</div></div>';
            
            document.getElementById('parentSubtitle').textContent = target;
            
            try {
                let url = `${API_BASE_URL}/exposed-credentials/summary/${encodeURIComponent(target)}?page=${parentCurrentPage}&size=${parentPageSize}`;
                
                if (dateFrom) url += `&date_from=${dateFrom}`;
                if (dateTo) url += `&date_to=${dateTo}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Token ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        credential_owner_domains: owners
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                parentDomainsData = data.entries || [];
                filteredParentData = [...parentDomainsData];
                
                // Update stats
                document.getElementById('totalSubdomains').textContent = (data.total || 0).toLocaleString();
                
                // Show footer
                document.getElementById('parentFooter').style.display = 'flex';
                
                renderParentDomains();
                
                // Show/hide pagination
                if (data.total > parentPageSize) {
                    document.getElementById('parentPagination').style.display = 'flex';
                    updateParentPagination(data.total);
                } else {
                    document.getElementById('parentPagination').style.display = 'none';
                }
                
                // If "Use Parent Domain" was selected, keep it selected and auto-load credentials for new parent
                // (unless we're skipping auto-load because credentials are being loaded in parallel)
                if (!skipAutoLoadCredentials) {
                    if (useParentDomainSelected) {
                        document.getElementById('useParentDomainToggle').checked = true;
                        await loadCredentials(target, owners);
                    } else {
                        // Only reset detail view if not using parent domain
                        resetDetailView();
                    }
                }
                
            } catch (error) {
                console.error('Error loading parent domains:', error);
                list.innerHTML = `<div class="empty-state"><span class="material-symbols-outlined">error</span><div class="empty-state-text">Error loading data: ${error.message}</div></div>`;
                alert(`Error loading data: ${error.message}`);
            }
        }

        function renderParentDomains() {
            const list = document.getElementById('subdomainsList');
            
            if (filteredParentData.length === 0) {
                list.innerHTML = '<div class="empty-state"><span class="material-symbols-outlined">search_off</span><div class="empty-state-text">No subdomains found</div></div>';
                return;
            }
            
            list.innerHTML = filteredParentData.map((item, index) => `
                <div class="sidebar-item" data-subdomain="${item.domain}" data-index="${index}">
                    <div class="item-domain">${escapeHtml(item.domain)}</div>
                    <div class="item-stats">
                        <span class="item-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#1f1f1f"><path d="M120-160v-112q0-34 17.5-62.5T184-378q62-31 126-46.5T440-440q20 0 40 1.5t40 4.5q-4 58 21 109.5t73 84.5v80H120ZM760-40l-60-60v-186q-44-13-72-49.5T600-420q0-58 41-99t99-41q58 0 99 41t41 99q0 45-25.5 80T790-290l50 50-60 60 60 60-80 80ZM440-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm300 80q17 0 28.5-11.5T780-440q0-17-11.5-28.5T740-480q-17 0-28.5 11.5T700-440q0 17 11.5 28.5T740-400Z"/></svg>
                            <strong>${item.credentials_count || 0}</strong> credentials
                        </span>
                    </div>
                </div>
            `).join('');
            
            // Add click handlers
            document.querySelectorAll('.sidebar-item[data-subdomain]').forEach(item => {
                item.addEventListener('click', async () => {
                    const subdomain = item.dataset.subdomain;
                    selectSubdomain(subdomain, item);
                });
            });
        }

        async function selectSubdomain(subdomain, itemElement) {
            // Highlight selected
            document.querySelectorAll('.sidebar-center .sidebar-item').forEach(el => el.classList.remove('selected'));
            itemElement.classList.add('selected');
            
            // Uncheck "Use Parent Domain" checkbox
            document.getElementById('useParentDomainToggle').checked = false;
            useParentDomainSelected = false;
            
            selectedSubdomain = subdomain;
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            
            await loadCredentials(subdomain, owners);
        }

        async function loadCredentials(subdomain, owners) {
            const content = document.getElementById('detailContent');
            content.innerHTML = '<div class="loading-spinner"><span class="material-symbols-outlined">progress_activity</span><div class="loading-text">Loading credentials...</div></div>';
            
            document.getElementById('detailSubtitle').textContent = subdomain;
            
            try {
                let url = `${API_BASE_URL}/exposed-credentials/records/${encodeURIComponent(subdomain)}?page=${credentialsCurrentPage}&size=${credentialsPageSize}`;
                
                if (dateFrom) url += `&date_from=${dateFrom}`;
                if (dateTo) url += `&date_to=${dateTo}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Token ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        credential_owner_domains: owners,
                        exclude_subdomains: excludeSubdomains
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                credentialsData = data.entries || [];
                filteredCredentialsData = [...credentialsData];
                
                // Update stats
                document.getElementById('totalCredentials').textContent = (data.total || 0).toLocaleString();
                
                // Show footer
                document.getElementById('credentialFooter').style.display = 'flex';
                
                renderCredentials();
                
                // Show/hide pagination
                if (data.total > credentialsPageSize) {
                    document.getElementById('credentialsPagination').style.display = 'flex';
                    updateCredentialsPagination(data.total);
                } else {
                    document.getElementById('credentialsPagination').style.display = 'none';
                }
                
            } catch (error) {
                console.error('Error loading credentials:', error);
                content.innerHTML = `<div class="empty-state"><span class="material-symbols-outlined">error</span><div class="empty-state-text">Error loading data: ${error.message}</div></div>`;
                alert(`Error loading data: ${error.message}`);
            }
        }

        function renderCredentials() {
            const content = document.getElementById('detailContent');
            
            if (filteredCredentialsData.length === 0) {
                content.innerHTML = '<div class="empty-state"><span class="material-symbols-outlined">search_off</span><div class="empty-state-text">No credentials found</div></div>';
                return;
            }
            
            const tableHtml = `
                <table class="credentials-table">
                    <thead>
                        <tr>
                            <th>Email/Username</th>
                            <th>Source</th>
                            <th>Channel</th>
                            <th>Leak Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredCredentialsData.map((cred, index) => `
                            <tr>
                                <td>${escapeHtml(cred.email || cred.username || 'N/A')}</td>
                                <td>
                                    <span class="source-badge source-${getSourceClass(cred.source_type)}">
                                        ${escapeHtml(cred.source_type || 'Unknown')}
                                    </span>
                                </td>
                                <td>${escapeHtml(cred.channel_title || 'N/A')}</td>
                                <td>${formatDate(cred.leak_date)}</td>
                                <td>
                                    <button class="view-json-btn" data-index="${index}">View JSON</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            content.innerHTML = tableHtml;
            
            // Add click handlers for JSON view
            document.querySelectorAll('.view-json-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const index = parseInt(btn.dataset.index);
                    viewCredentialJson(filteredCredentialsData[index]);
                });
            });
        }

        // Exclude Subdomains Toggle
        document.getElementById('excludeSubdomainsToggle').addEventListener('change', async (e) => {
            excludeSubdomains = e.target.checked;
            // Reload credentials with new exclude_subdomains setting
            if (selectedSubdomain) {
                const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
                credentialsCurrentPage = 1; // Reset to page 1
                await loadCredentials(selectedSubdomain, owners);
            }
        });

        // Search Filters
        document.getElementById('breachedSitesSearch').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filteredGlobalData = globalSummaryData.filter(item => 
                item.domain.toLowerCase().includes(query)
            );
            renderGlobalSummary();
        });

        document.getElementById('subdomainsSearch').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filteredParentData = parentDomainsData.filter(item => 
                item.domain.toLowerCase().includes(query)
            );
            renderParentDomains();
        });

        document.getElementById('credentialsSearch').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filteredCredentialsData = credentialsData.filter(cred => 
                (cred.email && cred.email.toLowerCase().includes(query)) ||
                (cred.username && cred.username.toLowerCase().includes(query)) ||
                (cred.source_type && cred.source_type.toLowerCase().includes(query))
            );
            renderCredentials();
        });

        // Pagination
        function updateGlobalPagination(total) {
            const totalPages = Math.ceil(total / globalPageSize);
            document.getElementById('globalPageInfo').textContent = `Page ${globalCurrentPage} of ${totalPages}`;
            document.getElementById('globalPrevBtn').disabled = globalCurrentPage === 1;
            document.getElementById('globalNextBtn').disabled = globalCurrentPage === totalPages;
        }

        function updateParentPagination(total) {
            const totalPages = Math.ceil(total / parentPageSize);
            document.getElementById('parentPageInfo').textContent = `Page ${parentCurrentPage} of ${totalPages}`;
            document.getElementById('parentPrevBtn').disabled = parentCurrentPage === 1;
            document.getElementById('parentNextBtn').disabled = parentCurrentPage === totalPages;
        }

        function updateCredentialsPagination(total) {
            const totalPages = Math.ceil(total / credentialsPageSize);
            document.getElementById('credentialsPageInfo').textContent = `Page ${credentialsCurrentPage} of ${totalPages}`;
            document.getElementById('credentialsPrevBtn').disabled = credentialsCurrentPage === 1;
            document.getElementById('credentialsNextBtn').disabled = credentialsCurrentPage === totalPages;
        }

        document.getElementById('globalPrevBtn').addEventListener('click', () => {
            if (globalCurrentPage > 1) {
                globalCurrentPage--;
                loadGlobalSummary();
            }
        });

        document.getElementById('globalNextBtn').addEventListener('click', () => {
            globalCurrentPage++;
            loadGlobalSummary();
        });

        document.getElementById('parentPrevBtn').addEventListener('click', () => {
            if (parentCurrentPage > 1) {
                parentCurrentPage--;
                const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
                loadParentDomains(currentMode === 'global' ? selectedTargetDomain : targetDomain, owners);
            }
        });

        document.getElementById('parentNextBtn').addEventListener('click', () => {
            parentCurrentPage++;
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            loadParentDomains(currentMode === 'global' ? selectedTargetDomain : targetDomain, owners);
        });

        // Use Parent Domain Toggle
        document.getElementById('useParentDomainToggle').addEventListener('change', async (e) => {
            const isChecked = e.target.checked;
            
            if (isChecked) {
                const parentDomain = currentMode === 'global' ? selectedTargetDomain : targetDomain;
                if (!parentDomain) {
                    e.target.checked = false;
                    return;
                }
                
                // Deselect all subdomain items
                document.querySelectorAll('.sidebar-center .sidebar-item').forEach(el => el.classList.remove('selected'));
                
                useParentDomainSelected = true;
                
                const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
                await loadCredentials(parentDomain, owners);
            } else {
                // If unchecked, clear the credentials view
                useParentDomainSelected = false;
                resetDetailView();
            }
        });

        document.getElementById('credentialsPrevBtn').addEventListener('click', () => {
            if (credentialsCurrentPage > 1) {
                credentialsCurrentPage--;
                const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
                loadCredentials(selectedSubdomain, owners);
            }
        });

        document.getElementById('credentialsNextBtn').addEventListener('click', () => {
            credentialsCurrentPage++;
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            loadCredentials(selectedSubdomain, owners);
        });

        // Page Size Selectors
        document.getElementById('globalPageSizeSelect').addEventListener('change', (e) => {
            globalPageSize = parseInt(e.target.value);
            globalCurrentPage = 1; // Reset to page 1
            if (credentialOwnerDomain && apiKey) {
                loadGlobalSummary();
            }
        });

        document.getElementById('parentPageSizeSelect').addEventListener('change', (e) => {
            parentPageSize = parseInt(e.target.value);
            parentCurrentPage = 1; // Reset to page 1
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            const target = currentMode === 'global' ? selectedTargetDomain : targetDomain;
            if (target && owners.length > 0 && apiKey) {
                loadParentDomains(target, owners);
            }
        });

        document.getElementById('credentialsPageSizeSelect').addEventListener('change', (e) => {
            credentialsPageSize = parseInt(e.target.value);
            credentialsCurrentPage = 1; // Reset to page 1
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            if (selectedSubdomain && apiKey) {
                loadCredentials(selectedSubdomain, owners);
            }
        });

        // JSON Modal
        function viewCredentialJson(credential) {
            document.getElementById('jsonContent').textContent = JSON.stringify(credential, null, 2);
            document.getElementById('jsonModal').style.display = 'flex';
        }

        document.getElementById('closeJsonModal').addEventListener('click', () => {
            document.getElementById('jsonModal').style.display = 'none';
        });

        document.getElementById('copyJsonBtn').addEventListener('click', () => {
            const jsonText = document.getElementById('jsonContent').textContent;
            navigator.clipboard.writeText(jsonText).then(() => {
                alert('JSON copied to clipboard!');
            });
        });

        // Export Functions
        document.getElementById('exportCsvBtn').addEventListener('click', () => {
            if (filteredCredentialsData.length === 0) {
                alert('No data to export');
                return;
            }
            exportToCsv();
        });

        document.getElementById('exportJsonBtn').addEventListener('click', () => {
            if (filteredCredentialsData.length === 0) {
                alert('No data to export');
                return;
            }
            exportToJson();
        });

        function exportToCsv() {
            const headers = ['Email/Username', 'Password', 'Domain', 'Source Type', 'Channel Title', 'Filename', 'Leak Date', 'Processed Date'];
            const rows = filteredCredentialsData.map(cred => [
                cred.email || cred.username || '',
                cred.password || '',
                cred.leaked_on_domain || cred.domain || '',
                cred.source_type || '',
                cred.channel_title || '',
                cred.filename || '',
                cred.leak_date || '',
                cred.processed_date || ''
            ]);
            
            let csvContent = '\uFEFF'; // UTF-8 BOM
            csvContent += headers.map(h => escapeCsvField(h)).join(',') + '\n';
            csvContent += rows.map(row => row.map(field => escapeCsvField(field)).join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `exposed-credentials-${selectedSubdomain || 'export'}-${formatDateForFilename(new Date())}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToJson() {
            const jsonContent = JSON.stringify({
                total: filteredCredentialsData.length,
                subdomain: selectedSubdomain,
                exported_at: new Date().toISOString(),
                entries: filteredCredentialsData
            }, null, 2);
            
            const blob = new Blob([jsonContent], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `exposed-credentials-${selectedSubdomain || 'export'}-${formatDateForFilename(new Date())}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Utility Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeCsvField(field) {
            const str = String(field);
            if (str.includes(',') || str.includes('"') || str.includes('\n') || str.includes('\r')) {
                return '"' + str.replace(/"/g, '""') + '"';
            }
            return str;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
            } catch {
                return dateString;
            }
        }

        function formatDateForFilename(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getSourceClass(sourceType) {
            if (!sourceType) return 'other';
            const type = sourceType.toLowerCase();
            if (type.includes('telegram')) return 'telegram';
            if (type.includes('discord')) return 'discord';
            return 'other';
        }

        function resetParentView() {
            document.getElementById('subdomainsList').innerHTML = '<div class="empty-state"><span class="material-symbols-outlined">arrow_back</span><div class="empty-state-text" id="subdomainsEmptyText"><span class="global-mode-text">Select a breached domain from the left</span><span class="search-mode-text hidden">Enter target and credential owners, then click Search</span></div></div>';
            document.getElementById('parentSubtitle').textContent = '—';
            document.getElementById('parentFooter').style.display = 'none';
            document.getElementById('subdomainsSearch').value = '';
            document.getElementById('totalSubdomains').textContent = '—';
            document.getElementById('useParentDomainToggle').checked = false;
            useParentDomainSelected = false;
            parentDomainsData = [];
            filteredParentData = [];
            selectedTargetDomain = null;
            parentCurrentPage = 1;
        }

        function resetDetailView() {
            document.getElementById('detailContent').innerHTML = '<div class="empty-state"><span class="material-symbols-outlined">arrow_back</span><div class="empty-state-text">Select a subdomain to view credentials</div></div>';
            document.getElementById('detailSubtitle').textContent = '—';
            document.getElementById('credentialFooter').style.display = 'none';
            document.getElementById('credentialsSearch').value = '';
            document.getElementById('totalCredentials').textContent = '—';
            credentialsData = [];
            filteredCredentialsData = [];
            selectedSubdomain = null;
            credentialsCurrentPage = 1;
        }

        // Show API key modal on load if no key
        window.addEventListener('load', () => {
            if (!apiKey) {
                setTimeout(() => {
                    document.getElementById('apiKeyModal').style.display = 'flex';
                }, 500);
            }
        });
    </script>
</body>
</html>



                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Token ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        credential_owner_domains: owners,
                        exclude_subdomains: excludeSubdomains
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                credentialsData = data.entries || [];
                filteredCredentialsData = [...credentialsData];
                
                // Update stats
                document.getElementById('totalCredentials').textContent = (data.total || 0).toLocaleString();
                
                // Show footer
                document.getElementById('credentialFooter').style.display = 'flex';
                
                renderCredentials();
                
                // Show/hide pagination
                if (data.total > credentialsPageSize) {
                    document.getElementById('credentialsPagination').style.display = 'flex';
                    updateCredentialsPagination(data.total);
                } else {
                    document.getElementById('credentialsPagination').style.display = 'none';
                }
                
            } catch (error) {
                console.error('Error loading credentials:', error);
                content.innerHTML = `<div class="empty-state"><span class="material-symbols-outlined">error</span><div class="empty-state-text">Error loading data: ${error.message}</div></div>`;
                alert(`Error loading data: ${error.message}`);
            }
        }

        function renderCredentials() {
            const content = document.getElementById('detailContent');
            
            if (filteredCredentialsData.length === 0) {
                content.innerHTML = '<div class="empty-state"><span class="material-symbols-outlined">search_off</span><div class="empty-state-text">No credentials found</div></div>';
                return;
            }
            
            const tableHtml = `
                <table class="credentials-table">
                    <thead>
                        <tr>
                            <th>Email/Username</th>
                            <th>Source</th>
                            <th>Channel</th>
                            <th>Leak Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredCredentialsData.map((cred, index) => `
                            <tr>
                                <td>${escapeHtml(cred.email || cred.username || 'N/A')}</td>
                                <td>
                                    <span class="source-badge source-${getSourceClass(cred.source_type)}">
                                        ${escapeHtml(cred.source_type || 'Unknown')}
                                    </span>
                                </td>
                                <td>${escapeHtml(cred.channel_title || 'N/A')}</td>
                                <td>${formatDate(cred.leak_date)}</td>
                                <td>
                                    <button class="view-json-btn" data-index="${index}">View JSON</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            content.innerHTML = tableHtml;
            
            // Add click handlers for JSON view
            document.querySelectorAll('.view-json-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const index = parseInt(btn.dataset.index);
                    viewCredentialJson(filteredCredentialsData[index]);
                });
            });
        }

        // Exclude Subdomains Toggle
        document.getElementById('excludeSubdomainsToggle').addEventListener('change', async (e) => {
            excludeSubdomains = e.target.checked;
            // Reload credentials with new exclude_subdomains setting
            if (selectedSubdomain) {
                const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
                credentialsCurrentPage = 1; // Reset to page 1
                await loadCredentials(selectedSubdomain, owners);
            }
        });

        // Search Filters
        document.getElementById('breachedSitesSearch').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filteredGlobalData = globalSummaryData.filter(item => 
                item.domain.toLowerCase().includes(query)
            );
            renderGlobalSummary();
        });

        document.getElementById('subdomainsSearch').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filteredParentData = parentDomainsData.filter(item => 
                item.domain.toLowerCase().includes(query)
            );
            renderParentDomains();
        });

        document.getElementById('credentialsSearch').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filteredCredentialsData = credentialsData.filter(cred => 
                (cred.email && cred.email.toLowerCase().includes(query)) ||
                (cred.username && cred.username.toLowerCase().includes(query)) ||
                (cred.source_type && cred.source_type.toLowerCase().includes(query))
            );
            renderCredentials();
        });

        // Pagination
        function updateGlobalPagination(total) {
            const totalPages = Math.ceil(total / globalPageSize);
            document.getElementById('globalPageInfo').textContent = `Page ${globalCurrentPage} of ${totalPages}`;
            document.getElementById('globalPrevBtn').disabled = globalCurrentPage === 1;
            document.getElementById('globalNextBtn').disabled = globalCurrentPage === totalPages;
        }

        function updateParentPagination(total) {
            const totalPages = Math.ceil(total / parentPageSize);
            document.getElementById('parentPageInfo').textContent = `Page ${parentCurrentPage} of ${totalPages}`;
            document.getElementById('parentPrevBtn').disabled = parentCurrentPage === 1;
            document.getElementById('parentNextBtn').disabled = parentCurrentPage === totalPages;
        }

        function updateCredentialsPagination(total) {
            const totalPages = Math.ceil(total / credentialsPageSize);
            document.getElementById('credentialsPageInfo').textContent = `Page ${credentialsCurrentPage} of ${totalPages}`;
            document.getElementById('credentialsPrevBtn').disabled = credentialsCurrentPage === 1;
            document.getElementById('credentialsNextBtn').disabled = credentialsCurrentPage === totalPages;
        }

        document.getElementById('globalPrevBtn').addEventListener('click', () => {
            if (globalCurrentPage > 1) {
                globalCurrentPage--;
                loadGlobalSummary();
            }
        });

        document.getElementById('globalNextBtn').addEventListener('click', () => {
            globalCurrentPage++;
            loadGlobalSummary();
        });

        document.getElementById('parentPrevBtn').addEventListener('click', () => {
            if (parentCurrentPage > 1) {
                parentCurrentPage--;
                const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
                loadParentDomains(currentMode === 'global' ? selectedTargetDomain : targetDomain, owners);
            }
        });

        document.getElementById('parentNextBtn').addEventListener('click', () => {
            parentCurrentPage++;
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            loadParentDomains(currentMode === 'global' ? selectedTargetDomain : targetDomain, owners);
        });

        // Use Parent Domain Toggle
        document.getElementById('useParentDomainToggle').addEventListener('change', async (e) => {
            const isChecked = e.target.checked;
            
            if (isChecked) {
                const parentDomain = currentMode === 'global' ? selectedTargetDomain : targetDomain;
                if (!parentDomain) {
                    e.target.checked = false;
                    return;
                }
                
                // Deselect all subdomain items
                document.querySelectorAll('.sidebar-center .sidebar-item').forEach(el => el.classList.remove('selected'));
                
                useParentDomainSelected = true;
                
                const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
                await loadCredentials(parentDomain, owners);
            } else {
                // If unchecked, clear the credentials view
                useParentDomainSelected = false;
                resetDetailView();
            }
        });

        document.getElementById('credentialsPrevBtn').addEventListener('click', () => {
            if (credentialsCurrentPage > 1) {
                credentialsCurrentPage--;
                const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
                loadCredentials(selectedSubdomain, owners);
            }
        });

        document.getElementById('credentialsNextBtn').addEventListener('click', () => {
            credentialsCurrentPage++;
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            loadCredentials(selectedSubdomain, owners);
        });

        // Page Size Selectors
        document.getElementById('globalPageSizeSelect').addEventListener('change', (e) => {
            globalPageSize = parseInt(e.target.value);
            globalCurrentPage = 1; // Reset to page 1
            if (credentialOwnerDomain && apiKey) {
                loadGlobalSummary();
            }
        });

        document.getElementById('parentPageSizeSelect').addEventListener('change', (e) => {
            parentPageSize = parseInt(e.target.value);
            parentCurrentPage = 1; // Reset to page 1
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            const target = currentMode === 'global' ? selectedTargetDomain : targetDomain;
            if (target && owners.length > 0 && apiKey) {
                loadParentDomains(target, owners);
            }
        });

        document.getElementById('credentialsPageSizeSelect').addEventListener('change', (e) => {
            credentialsPageSize = parseInt(e.target.value);
            credentialsCurrentPage = 1; // Reset to page 1
            const owners = currentMode === 'global' ? [credentialOwnerDomain] : credentialOwners;
            if (selectedSubdomain && apiKey) {
                loadCredentials(selectedSubdomain, owners);
            }
        });

        // JSON Modal
        function viewCredentialJson(credential) {
            document.getElementById('jsonContent').textContent = JSON.stringify(credential, null, 2);
            document.getElementById('jsonModal').style.display = 'flex';
        }

        document.getElementById('closeJsonModal').addEventListener('click', () => {
            document.getElementById('jsonModal').style.display = 'none';
        });

        document.getElementById('copyJsonBtn').addEventListener('click', () => {
            const jsonText = document.getElementById('jsonContent').textContent;
            navigator.clipboard.writeText(jsonText).then(() => {
                alert('JSON copied to clipboard!');
            });
        });

        // Export Functions
        document.getElementById('exportCsvBtn').addEventListener('click', () => {
            if (filteredCredentialsData.length === 0) {
                alert('No data to export');
                return;
            }
            exportToCsv();
        });

        document.getElementById('exportJsonBtn').addEventListener('click', () => {
            if (filteredCredentialsData.length === 0) {
                alert('No data to export');
                return;
            }
            exportToJson();
        });

        function exportToCsv() {
            const headers = ['Email/Username', 'Password', 'Domain', 'Source Type', 'Channel Title', 'Filename', 'Leak Date', 'Processed Date'];
            const rows = filteredCredentialsData.map(cred => [
                cred.email || cred.username || '',
                cred.password || '',
                cred.leaked_on_domain || cred.domain || '',
                cred.source_type || '',
                cred.channel_title || '',
                cred.filename || '',
                cred.leak_date || '',
                cred.processed_date || ''
            ]);
            
            let csvContent = '\uFEFF'; // UTF-8 BOM
            csvContent += headers.map(h => escapeCsvField(h)).join(',') + '\n';
            csvContent += rows.map(row => row.map(field => escapeCsvField(field)).join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `exposed-credentials-${selectedSubdomain || 'export'}-${formatDateForFilename(new Date())}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToJson() {
            const jsonContent = JSON.stringify({
                total: filteredCredentialsData.length,
                subdomain: selectedSubdomain,
                exported_at: new Date().toISOString(),
                entries: filteredCredentialsData
            }, null, 2);
            
            const blob = new Blob([jsonContent], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `exposed-credentials-${selectedSubdomain || 'export'}-${formatDateForFilename(new Date())}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Utility Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeCsvField(field) {
            const str = String(field);
            if (str.includes(',') || str.includes('"') || str.includes('\n') || str.includes('\r')) {
                return '"' + str.replace(/"/g, '""') + '"';
            }
            return str;
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
            } catch {
                return dateString;
            }
        }

        function formatDateForFilename(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function getSourceClass(sourceType) {
            if (!sourceType) return 'other';
            const type = sourceType.toLowerCase();
            if (type.includes('telegram')) return 'telegram';
            if (type.includes('discord')) return 'discord';
            return 'other';
        }

        function resetParentView() {
            document.getElementById('subdomainsList').innerHTML = '<div class="empty-state"><span class="material-symbols-outlined">arrow_back</span><div class="empty-state-text" id="subdomainsEmptyText"><span class="global-mode-text">Select a breached domain from the left</span><span class="search-mode-text hidden">Enter target and credential owners, then click Search</span></div></div>';
            document.getElementById('parentSubtitle').textContent = '—';
            document.getElementById('parentFooter').style.display = 'none';
            document.getElementById('subdomainsSearch').value = '';
            document.getElementById('totalSubdomains').textContent = '—';
            document.getElementById('useParentDomainToggle').checked = false;
            useParentDomainSelected = false;
            parentDomainsData = [];
            filteredParentData = [];
            selectedTargetDomain = null;
            parentCurrentPage = 1;
        }

        function resetDetailView() {
            document.getElementById('detailContent').innerHTML = '<div class="empty-state"><span class="material-symbols-outlined">arrow_back</span><div class="empty-state-text">Select a subdomain to view credentials</div></div>';
            document.getElementById('detailSubtitle').textContent = '—';
            document.getElementById('credentialFooter').style.display = 'none';
            document.getElementById('credentialsSearch').value = '';
            document.getElementById('totalCredentials').textContent = '—';
            credentialsData = [];
            filteredCredentialsData = [];
            selectedSubdomain = null;
            credentialsCurrentPage = 1;
        }

        // Show API key modal on load if no key
        window.addEventListener('load', () => {
            if (!apiKey) {
                setTimeout(() => {
                    document.getElementById('apiKeyModal').style.display = 'flex';
                }, 500);
            }
        });
    </script>
</body>
</html>


